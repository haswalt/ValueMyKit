var vmk={amazon:{keyId:"0QKNT33QJ8T5NYMAYP02",secret:"w6olv/GbYYZkD9QZTJa7dvt2SLczvJxficFQkdgk",productLimit:3},ebay:{apiVersion:"1.0.0",appId:"LQDInter-d3b1-490b-8acc-d6c9a8c08c6a",globalId:"EBAY-US",cs:["For Parts Not Working","Acceptable","Good","Very Good","Used","Seller Refurbished","Manufacturer Refurbished","New With Defects","New"],perPage:"1000"},alertTimer:null,products:[],productId:0,c:"Used",priceDeviance:"0.10",init:function(){$("#we").find("p").fadeOut("fast",function(){$("#we").find("form").slideDown()});$("#we").delegate("form","submit",function(){var a=$(this).find("input[name=q]").val();if(a.length<2){vmk.alertBar("You product name is too short!");return false}$("#we").slideUp();$("#p").slideDown();vmk.productLookup(a,$(this).find("select").val());return false})},getc:function(){$("#p").slideUp(function(){$("#c").slideDown(function(){$("#t").find("li").removeClass("active").filter(":nth-child(2)").addClass("active")})});$("#c").find("input[type=range]").bind("change",function(){vmk.c=vmk.ebay.cs[$(this).val()];var c=(100/9)*(9-$(this).val());var b=Math.floor((255*c)/100);var a=Math.floor((255*(100-c))/100);$("#c").find(".output").text(vmk.c).css({backgroundColor:"rgb("+b+", "+a+", 0)"})});$("#c").delegate("form","submit",function(){vmk.getPrices(vmk.c);return false})},getPrices:function(g){$("#c").slideUp(function(){$("#t").find("li").removeClass("active").filter(":last").addClass("active");$("#e").slideDown()});var b="http://svcs.ebay.com/services/search/FindingService/v1?";var e="OPERATION-NAME=findItemsAdvanced&SERVICE-VERSION="+this.ebay.apiVersion+"&RESPONSE-DATA-FORMAT=JSON&SECURITY-APPNAME="+this.ebay.appId+"&GLOBAL-ID="+this.ebay.globalId+"&REST-PAYLOAD&paginationInput.entriesPerPage="+this.ebay.perPage+"&itemFilter(0).name=c&itemFilter(0).value(0)="+g+"&SoldItemsOnly=true";var a=/[\w\.-_\s]+/;var f=vmk.products[vmk.productId].ItemAttributes.Title.match(a);var d=b+e+'&keywords="'+encodeURIComponent(f)+'"&callback=?';$.getJSON(d,function(m){if(m.findItemsAdvancedResponse[0].searchResult["@count"]==0){$("#e").slideUp(function(){$("#we").slideDown()});vmk.alertBar("Sorry, we could not calculate an estimate","error")}var n=new Array();var u=0;for(var o in m.findItemsAdvancedResponse[0].searchResult[0].item){var w=m.findItemsAdvancedResponse[0].searchResult[0].item[o];var q=parseFloat(w.sellingStatus[0].currentPrice[0]["__value__"]);n.push(q);u+=+q}n.sort(vmk.asc);var v=u/n.length;var r=v*vmk.priceDeviance;var k=v-r;var s=v+r;var c=new Array();for(var o in n){var q=n[o];if(q>=k&&q<=s){c.push(q)}}c.sort(vmk.asc);var l=c[0];var t=c[c.length-1];var h=new Array();var j=0;var p=0;for(var o in c){var q=c[o];if(typeof(h[q])!="undefined"){h[q]++}else{h[q]=1}if(h[q]>j){j=h[q];p=q}else{if(h[q]==j&&q>p){p=q}}}$("#e").html("<h2>We estimate your kit is worth &pound;"+p+".</h2><h3>We found it available for between &pound;"+l+" and &pound;"+t+"</h3>")})},productLookup:function(f,d){var b="http://query.yahooapis.com/v1/public/yql?q=";var a='USE "http://www.datatables.org/amazon/amazon.ecs.xml" AS amazon.ecs;';var e="SELECT ItemAttributes.Title, MediumImage.URL, Offers.Offer.OfferListing.Price FROM amazon.ecs("+this.amazon.productLimit+') WHERE Operation = "ItemSearch" AND SearchIndex = "'+d+'" AND ResponseGroup = "Medium,Offers" AND AWSAccessKeyId = "'+this.amazon.keyId+'" AND secret = "'+this.amazon.secret+'" AND Keywords = "'+f+'"';var c=b+encodeURIComponent(a+e)+"&format=json&callback=?";$.getJSON(c,this.parseAmazonProducts)},parseAmazonProducts:function(d){if(d.query.results==null||d.query.results.Item.length<1){$("#p").slideUp();$("#we").slideDown();vmk.alertBar("No Products found!","error");return false}$("#we").slideUp();$("#p").slideDown();$("#p").html("<h2>Please select the product closest to the your item</h2>");for(var b in d.query.results.Item){var c=d.query.results.Item[b];if(typeof(c.ItemAttributes)!="undefined"){var a='<div class="no-image">No Product Image</div>';if(typeof(c.MediumImage)!="undefined"){a='<img src="'+c.MediumImage.URL+'" width="108">'}detail=$("<ul><li>"+a+"</li><li><h3>"+c.ItemAttributes.Title+"</h3><hr><p><a href=# data-pid="+b+" class=b>Choose</a></li></ul><div style=clear:both></div>");detail.hide();$("#p").append(detail);detail.slideDown();vmk.products[b]=c}}if(vmk.products.length<1){$("#p").slideUp();$("#we").slideDown();vmk.alertBar("No Products found!","error");return false}$("#p").delegate("a.b","click",function(){vmk.productId=$(this).attr("data-pid");vmk.getc();return false})},alertBar:function(b,a){$("#al").html(b).slideDown(500);clearTimeout(vmk.alertTimer);vmk.alertTimer=setTimeout(function(){$("#al").slideUp(300)},2000)},asc:function(d,c){return(d-c)}};